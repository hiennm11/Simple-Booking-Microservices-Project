# Saga Pattern Visual Diagrams

## ğŸ“Š Visual Learning Guide for Saga Pattern Implementation

This document provides visual representations of the Saga pattern implementation in the booking system.

---

## 1. Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT APPLICATION                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP/REST
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API GATEWAY                              â”‚
â”‚  - JWT Authentication                                            â”‚
â”‚  - YARP Reverse Proxy                                           â”‚
â”‚  - Correlation ID Generation                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER       â”‚   â”‚   BOOKING    â”‚   â”‚  INVENTORY   â”‚
â”‚   SERVICE    â”‚   â”‚   SERVICE    â”‚   â”‚   SERVICE    â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ - Auth       â”‚   â”‚ - Saga Start â”‚   â”‚ - Reserve    â”‚
â”‚ - JWT        â”‚   â”‚ - Outbox     â”‚   â”‚ - Release    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                  â”‚
                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚   â”‚
                          â–¼   â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  RABBITMQ    â”‚
                   â”‚  EVENT BUS   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  PAYMENT     â”‚
                   â”‚  SERVICE     â”‚
                   â”‚              â”‚
                   â”‚ - Process    â”‚
                   â”‚ - Trigger    â”‚
                   â”‚   Compensate â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Saga Flow - Success Scenario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT  â”‚     â”‚ BOOKING  â”‚     â”‚INVENTORY â”‚     â”‚ PAYMENT  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                â”‚                â”‚                â”‚
      â”‚ 1. POST        â”‚                â”‚                â”‚
      â”‚ /api/booking   â”‚                â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 200 OK         â”‚                â”‚                â”‚
      â”‚ BookingId      â”‚                â”‚                â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚ 2. BookingCreatedEvent          â”‚
      â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 3. Reserve     â”‚
      â”‚                â”‚                â”‚ Inventory      â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 4. InventoryReservedEvent
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 5. Process     â”‚
      â”‚                â”‚                â”‚    Payment     â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚ 6. PaymentSucceededEvent        â”‚
      â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚ 7. Update      â”‚                â”‚
      â”‚                â”‚ Status =       â”‚                â”‚
      â”‚                â”‚ CONFIRMED      â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 8. PaymentSucceededEvent
      â”‚                â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 9. Confirm     â”‚
      â”‚                â”‚                â”‚ Reservation    â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 10. GET        â”‚                â”‚                â”‚
      â”‚ /api/booking/  â”‚                â”‚                â”‚
      â”‚ {id}           â”‚                â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 200 OK         â”‚                â”‚                â”‚
      â”‚ Status:        â”‚                â”‚                â”‚
      â”‚ CONFIRMED âœ…   â”‚                â”‚                â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
```

---

## 3. Saga Flow - Payment Failure with Compensation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT  â”‚     â”‚ BOOKING  â”‚     â”‚INVENTORY â”‚     â”‚ PAYMENT  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                â”‚                â”‚                â”‚
      â”‚ 1-4. Same as success scenario   â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 5. Process     â”‚
      â”‚                â”‚                â”‚ Payment FAILS  â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 6. PaymentFailedEvent
      â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚ 7. Update      â”‚ 7. Release     â”‚
      â”‚                â”‚ Status =       â”‚ Inventory      â”‚
      â”‚                â”‚ CANCELLED      â”‚ (Compensate)   â”‚
      â”‚                â”‚ âª             â”‚ âª             â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ AvailableQty++ â”‚
      â”‚                â”‚                â”‚ ReservedQty--  â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 8. InventoryReleasedEvent
      â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 9. GET         â”‚                â”‚                â”‚
      â”‚ /api/booking/  â”‚                â”‚                â”‚
      â”‚ {id}           â”‚                â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 200 OK         â”‚                â”‚                â”‚
      â”‚ Status:        â”‚                â”‚                â”‚
      â”‚ CANCELLED âŒ   â”‚                â”‚                â”‚
      â”‚ Reason:        â”‚                â”‚                â”‚
      â”‚ Payment failed â”‚                â”‚                â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
```

---

## 4. Saga Flow - Insufficient Inventory

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT  â”‚     â”‚ BOOKING  â”‚     â”‚INVENTORY â”‚     â”‚ PAYMENT  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                â”‚                â”‚                â”‚
      â”‚ 1. POST        â”‚                â”‚                â”‚
      â”‚ /api/booking   â”‚                â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 200 OK         â”‚                â”‚                â”‚
      â”‚ BookingId      â”‚                â”‚                â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚ 2. BookingCreatedEvent          â”‚
      â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ 3. Check       â”‚
      â”‚                â”‚                â”‚ Inventory      â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ AvailableQty=0 â”‚
      â”‚                â”‚                â”‚ â›” FAIL       â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚ 4. InventoryReservationFailedEvent
      â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚ 5. Update      â”‚                â”‚
      â”‚                â”‚ Status =       â”‚                â”‚
      â”‚                â”‚ CANCELLED      â”‚                â”‚
      â”‚                â”‚ âª             â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 6. GET         â”‚                â”‚                â”‚
      â”‚ /api/booking/  â”‚                â”‚                â”‚
      â”‚ {id}           â”‚                â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚ 200 OK         â”‚                â”‚                â”‚
      â”‚ Status:        â”‚                â”‚                â”‚
      â”‚ CANCELLED âŒ   â”‚                â”‚                â”‚
      â”‚ Reason:        â”‚                â”‚                â”‚
      â”‚ Insufficient   â”‚                â”‚                â”‚
      â”‚ inventory      â”‚                â”‚                â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
      â”‚                â”‚                â”‚                â”‚
      â”‚                â”‚                â”‚ NOTE: Payment  â”‚
      â”‚                â”‚                â”‚ never triggeredâ”‚
      â”‚                â”‚                â”‚ âœ… Resources   â”‚
      â”‚                â”‚                â”‚ saved          â”‚
```

---

## 5. Event Choreography Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RABBITMQ QUEUES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚booking_      â”‚inventory_    â”‚payment_      â”‚inventory_       â”‚
â”‚created       â”‚reserved      â”‚succeeded     â”‚released         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚              â”‚
       â”‚              â”‚              â”‚              â”‚
  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”     â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
  â”‚Inventoryâ”‚    â”‚Payment â”‚    â”‚Booking â”‚    â”‚Booking â”‚
  â”‚Consumer â”‚    â”‚Consumerâ”‚    â”‚Consumerâ”‚    â”‚Consumerâ”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚             â”‚             â”‚             â”‚
       â”‚ Reserve     â”‚ Process     â”‚ Confirm     â”‚ Audit
       â”‚ Inventory   â”‚ Payment     â”‚ Booking     â”‚ Log
       â”‚             â”‚             â”‚             â”‚
       â–¼             â–¼             â–¼             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Publish â”‚    â”‚Publish â”‚    â”‚Publish â”‚    â”‚  Log   â”‚
  â”‚Reservedâ”‚    â”‚Succeed/â”‚    â”‚Confirmedâ”‚   â”‚Releasedâ”‚
  â”‚Event   â”‚    â”‚Failed  â”‚    â”‚Event   â”‚    â”‚Event   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. State Transition Diagram

```
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   PENDING    â”‚ â† Initial state (Booking created)
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESERVED     â”‚         â”‚  CANCELLED    â”‚
â”‚ (Inventory OK)â”‚         â”‚(No Inventory) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â–²
        â”‚                         â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”                   â”‚
    â”‚Payment?â”‚                   â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â”‚
        â”‚                         â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”                   â”‚
    â”‚        â”‚                   â”‚
 Success  Failed                 â”‚
    â”‚        â”‚                   â”‚
    â–¼        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONFIRMED    â”‚ â† Final success state
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
â”â”â” Forward flow (saga progression)
â”„â”„â”„ Compensation flow (rollback)
```

---

## 7. Compensation Actions Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FORWARD ACTION  â”‚ TRIGGER          â”‚ COMPENSATING ACTION   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Create Booking  â”‚ -                â”‚ Cancel Booking        â”‚
â”‚ (PENDING)       â”‚                  â”‚ (CANCELLED)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Reserve         â”‚ PaymentFailed    â”‚ Release Inventory     â”‚
â”‚ Inventory       â”‚ Event            â”‚ Restore quantities    â”‚
â”‚ (AvailableQty--)â”‚                  â”‚ (AvailableQty++)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Process Payment â”‚ -                â”‚ Refund Payment        â”‚
â”‚ (SUCCESS)       â”‚                  â”‚ (REFUNDED)            â”‚
â”‚                 â”‚                  â”‚ [Not impl. yet]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Compensation Guarantees:
âœ… At-least-once delivery (RabbitMQ)
âœ… Idempotent handlers (safe to retry)
âœ… Polly retry (3 attempts exponential backoff)
âœ… Dead Letter Queue (manual intervention)
```

---

## 8. Correlation ID Flow

```
Request 1 (CorrelationId: abc-123)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  [Gateway] Generate CorrelationId: abc-123                  â”‚
â”‚      â†“                                                       â”‚
â”‚  [BookingService] Log: "Booking created" {CorrelationId}    â”‚
â”‚      â†“                                                       â”‚
â”‚  [Event] BookingCreatedEvent {CorrelationId: abc-123}       â”‚
â”‚      â†“                                                       â”‚
â”‚  [InventoryService] Log: "Processing..." {CorrelationId}    â”‚
â”‚      â†“                                                       â”‚
â”‚  [Event] InventoryReservedEvent {CorrelationId: abc-123}    â”‚
â”‚      â†“                                                       â”‚
â”‚  [PaymentService] Log: "Payment processed" {CorrelationId}  â”‚
â”‚      â†“                                                       â”‚
â”‚  [Event] PaymentSucceededEvent {CorrelationId: abc-123}     â”‚
â”‚      â†“                                                       â”‚
â”‚  [BookingService] Log: "Booking confirmed" {CorrelationId}  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Request 2 (CorrelationId: def-456)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Separate flow with different CorrelationId]               â”‚
â”‚  All logs tagged with: def-456                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Query in Seq:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CorrelationId = 'abc-123'                                   â”‚
â”‚   â†’ Shows entire Request 1 flow across all services        â”‚
â”‚                                                              â”‚
â”‚ CorrelationId = 'def-456'                                   â”‚
â”‚   â†’ Shows entire Request 2 flow across all services        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Retry and DLQ Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MESSAGE PROCESSING                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Receive Message â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Process Event   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                     â”‚
            Success               Failure
                â”‚                     â”‚
                â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ACK Message  â”‚     â”‚ NACK Message â”‚
        â”‚ Remove from  â”‚     â”‚ with requeue â”‚
        â”‚ Queue        â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                                    â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ Retry Count  â”‚
                           â”‚ < Max (3)?   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                   â”‚
                      YES                  NO
                        â”‚                   â”‚
                        â–¼                   â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Requeue      â”‚    â”‚ Send to DLQ  â”‚
                â”‚ Message      â”‚    â”‚ Log Error    â”‚
                â”‚              â”‚    â”‚ Alert Ops    â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Wait...
                       â”‚
                       â–¼
            Back to Process Event
```

---

## 10. Outbox Pattern Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BOOKING SERVICE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Create Booking  â”‚
                  â”‚ (PENDING)       â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Same Database Transaction
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚
              â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT INTO     â”‚      â”‚ INSERT INTO     â”‚
    â”‚ Bookings        â”‚      â”‚ OutboxMessages  â”‚
    â”‚                 â”‚      â”‚                 â”‚
    â”‚ Id: xxx         â”‚      â”‚ EventType:      â”‚
    â”‚ Status: PENDING â”‚      â”‚ BookingCreated  â”‚
    â”‚ ...             â”‚      â”‚ Payload: JSON   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ Published: falseâ”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                  COMMIT TRANSACTION â”€â”˜
                                      â”‚
                                      â”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Outbox          â”‚
                             â”‚ Publisher       â”‚
                             â”‚ (Background)    â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                         Poll every 1 second
                                      â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Unpublished?    â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                     YES
                                      â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Publish to      â”‚
                             â”‚ RabbitMQ        â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ UPDATE          â”‚
                             â”‚ Published=true  â”‚
                             â”‚ PublishedAt=NOW â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
âœ… Atomic: Booking + Event saved together
âœ… No event loss if RabbitMQ is down
âœ… Retry: Poll until successful
âœ… Audit trail: All events in DB
```

---

## 11. Complete System Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ JWT Token
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API GATEWAY (Port 5000)                   â”‚
â”‚  â€¢ Validate JWT                                               â”‚
â”‚  â€¢ Generate CorrelationId                                     â”‚
â”‚  â€¢ Route to services                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚               â”‚
          â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚UserService  â”‚  â”‚BookingServiceâ”‚ â”‚InventoryServiceâ”‚
â”‚Port: 5001   â”‚  â”‚Port: 5002   â”‚  â”‚Port: 5004   â”‚
â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
â”‚PostgreSQL   â”‚  â”‚PostgreSQL   â”‚  â”‚PostgreSQL   â”‚
â”‚Port: 5432   â”‚  â”‚Port: 5433   â”‚  â”‚Port: 5435   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚  â”‚
                        â–¼  â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  RabbitMQ    â”‚
                 â”‚  Port: 5672  â”‚
                 â”‚  UI: 15672   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚PaymentServiceâ”‚
                 â”‚Port: 5003    â”‚
                 â”‚              â”‚
                 â”‚MongoDB       â”‚
                 â”‚Port: 27017   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Observability:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Seq Logs    â”‚
â”‚  Port: 5341  â”‚
â”‚              â”‚
â”‚  â€¢ All logs  â”‚
â”‚  â€¢ CorrelationIdâ”‚
â”‚  â€¢ Search    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. Timing Diagram (Successful Flow)

```
Time    BookingService    InventoryService    PaymentService
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T0      POST /api/booking
        â”‚
T1      Create booking
        Status: PENDING
        â”‚
T2      Save to outbox
        BookingCreatedEvent
        â”‚
T3      Outbox publisher
        sends to RabbitMQ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
        â”‚                             â”‚
T4                                    Receive event
                                      â”‚
T5                                    Check inventory
                                      â”‚
T6                                    Reserve inventory
                                      AvailableQty: 1â†’0
                                      â”‚
T7                                    Publish event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
        â”‚                                                      â”‚
T8                                                        Receive event
                                                               â”‚
T9                                                        Process payment
                                                        (70% success rate)
                                                               â”‚
T10                                                       Publish event
        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
T11     Receive event                 Receive event
        â”‚                             â”‚
T12     Update booking                Update reservation
        Status: CONFIRMED             Status: CONFIRMED
        â”‚                             â”‚
T13     Done âœ…                       Done âœ…

Total Duration: ~200-500ms (depending on payment simulation)
```

---

## 13. Error Scenarios Decision Tree

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Start Saga       â”‚
                    â”‚ (Create Booking) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Reserve          â”‚
                    â”‚ Inventory?       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
                Available         Not Available
                    â”‚                 â”‚
                    â–¼                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Inventory    â”‚  â”‚ Cancel       â”‚
            â”‚ Reserved     â”‚  â”‚ Booking      â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ (CANCELLED)  â”‚
                   â”‚          â”‚ Publish      â”‚
                   â–¼          â”‚ InventoryRes-â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ ervationFail â”‚
            â”‚ Process      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ Payment?     â”‚         â–²
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                   â”‚                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
          â”‚                 â”‚        â”‚
       Success           Failed      â”‚
          â”‚                 â”‚        â”‚
          â–¼                 â–¼        â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
  â”‚ Confirm      â”‚  â”‚ Release      â”‚â”‚
  â”‚ Booking      â”‚  â”‚ Inventory    â”‚â”‚
  â”‚ Confirm      â”‚  â”‚ Cancel       â”‚â”‚
  â”‚ Inventory    â”‚  â”‚ Booking      â”‚â”‚
  â”‚              â”‚  â”‚              â”‚â”‚
  â”‚ âœ… SUCCESS  â”‚  â”‚ âª ROLLBACK â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 14. Monitoring Dashboard Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEQ DASHBOARD                             â”‚
â”‚                   http://localhost:5341                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Quick Queries:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CorrelationId = '<paste-from-test>'                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ @Level = 'Error'                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Service = 'BookingService' and @Message like '%CANCELLED'â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Timeline View:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 07:43:52  [BookingService]  Booking created            â”‚ â”‚
â”‚  â”‚ 07:43:52  [InventoryService] Processing booking        â”‚ â”‚
â”‚  â”‚ 07:43:53  [InventoryService] Inventory reserved        â”‚ â”‚
â”‚  â”‚ 07:43:53  [PaymentService]   Payment processing        â”‚ â”‚
â”‚  â”‚ 07:43:53  [PaymentService]   Payment FAILED âŒ         â”‚ â”‚
â”‚  â”‚ 07:43:54  [InventoryService] Releasing inventory âª    â”‚ â”‚
â”‚  â”‚ 07:43:54  [BookingService]   Booking cancelled         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RABBITMQ DASHBOARD                          â”‚
â”‚                  http://localhost:15672                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Queues Overview:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Queue Name               â”‚ Messages â”‚ Consumers         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ booking_created          â”‚ 0        â”‚ 1 (Inventory)    â”‚ â”‚
â”‚  â”‚ inventory_reserved       â”‚ 0        â”‚ 1 (Payment)      â”‚ â”‚
â”‚  â”‚ payment_succeeded        â”‚ 0        â”‚ 2 (Booking+Inv)  â”‚ â”‚
â”‚  â”‚ payment_failed           â”‚ 0        â”‚ 2 (Booking+Inv)  â”‚ â”‚
â”‚  â”‚ inventory_res_failed     â”‚ 0        â”‚ 1 (Booking)      â”‚ â”‚
â”‚  â”‚ payment_succeeded_dlq    â”‚ 0        â”‚ 0 (DLQ)          â”‚ â”‚
â”‚  â”‚ payment_failed_dlq       â”‚ 0        â”‚ 0 (DLQ)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 15. Code Organization Map

```
src/
â”œâ”€â”€ BookingService/
â”‚   â”œâ”€â”€ Consumers/
â”‚   â”‚   â”œâ”€â”€ PaymentSucceededConsumer.cs â”€â”€â”€â”€â”
â”‚   â”‚   â”œâ”€â”€ PaymentFailedConsumer.cs â”€â”€â”€â”€â”€â”€â”€â”¼â”€ Saga steps
â”‚   â”‚   â””â”€â”€ InventoryReservationFailedConsumer.cs â”€â”˜
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â””â”€â”€ OutboxService.cs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Reliable publishing
â”‚   â””â”€â”€ BackgroundServices/
â”‚       â””â”€â”€ OutboxPublisherService.cs â”€â”€â”€â”€â”€â”€â”€â”€  Background worker
â”‚
â”œâ”€â”€ InventoryService/
â”‚   â”œâ”€â”€ Consumers/
â”‚   â”‚   â”œâ”€â”€ BookingCreatedConsumer.cs â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”œâ”€â”€ PaymentSucceededConsumer.cs â”€â”€â”€â”€â”¼â”€ Saga steps
â”‚   â”‚   â””â”€â”€ PaymentFailedConsumer.cs â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â””â”€â”€ Services/
â”‚       â””â”€â”€ InventoryManagementService.cs â”€â”€â”€â”€ Business logic
â”‚
â”œâ”€â”€ PaymentService/
â”‚   â”œâ”€â”€ Consumers/
â”‚   â”‚   â”œâ”€â”€ InventoryReservedConsumer.cs â”€â”€â”€â”
â”‚   â”‚   â””â”€â”€ RetryPaymentConsumer.cs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ Saga steps
â”‚   â””â”€â”€ Services/                            â”‚
â”‚       â””â”€â”€ PaymentProcessingService.cs â”€â”€â”€â”€â”€â”˜
â”‚
â””â”€â”€ Shared/
    â””â”€â”€ Contracts/
        â”œâ”€â”€ BookingCreatedEvent.cs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”œâ”€â”€ InventoryReservedEvent.cs â”€â”€â”€â”€â”€â”€â”¤
        â”œâ”€â”€ InventoryReservationFailedEvent â”‚
        â”œâ”€â”€ PaymentSucceededEvent.cs â”€â”€â”€â”€â”€â”€â”€â”¼â”€ Event definitions
        â”œâ”€â”€ PaymentFailedEvent.cs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”œâ”€â”€ InventoryReleasedEvent.cs â”€â”€â”€â”€â”€â”€â”‚
        â””â”€â”€ BookingCancelledEvent.cs â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Usage**: Use these diagrams during code review, architecture discussions, and learning sessions.

**Next Steps**: 
1. Review code implementation in the mapped files
2. Run tests and observe actual flow in Seq
3. Experiment with failure scenarios
4. Build your own saga patterns using these templates

**Last Updated**: November 12, 2025
