# Authorization Flow Diagrams

## 1. User Registration & Login Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                 â”‚ API Gateway â”‚                 â”‚ UserService â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚                               â”‚
     â”‚ 1. POST /api/users/register â”‚                               â”‚
     â”‚ {username, email, password} â”‚                               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                               â”‚
     â”‚                             â”‚ 2. Forward request            â”‚
     â”‚                             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                             â”‚                               â”‚
     â”‚                             â”‚                     3. Validate data
     â”‚                             â”‚                     4. Hash password
     â”‚                             â”‚                     5. Save to DB
     â”‚                             â”‚                               â”‚
     â”‚                             â”‚ 6. Return user data           â”‚
     â”‚                             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 7. 200 OK {user}            â”‚                               â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
     â”‚                             â”‚                               â”‚
     â”‚ 8. POST /api/users/login    â”‚                               â”‚
     â”‚ {username, password}        â”‚                               â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                               â”‚
     â”‚                             â”‚ 9. Forward request            â”‚
     â”‚                             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                             â”‚                               â”‚
     â”‚                             â”‚                  10. Verify password
     â”‚                             â”‚                  11. Generate JWT
     â”‚                             â”‚                      {                               â”‚                             â”‚                        "sub": "user-id",
     â”‚                             â”‚                        "unique_name": "username",
     â”‚                             â”‚                        "email": "email",
     â”‚                             â”‚                        "exp": 1234567890
     â”‚                             â”‚                      }
     â”‚                             â”‚                               â”‚
     â”‚                             â”‚ 12. Return JWT token          â”‚
     â”‚                             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 13. 200 OK {token, user}    â”‚                               â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
     â”‚                             â”‚                               â”‚
     â”‚ 14. Store token locally     â”‚                               â”‚
     â”‚                             â”‚                               â”‚
```

## 2. Authenticated Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚         â”‚ API Gateway â”‚         â”‚BookingServiceâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                       â”‚
     â”‚ 1. GET /api/bookingsâ”‚                       â”‚
     â”‚ Authorization: Bearer <JWT_TOKEN>           â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
     â”‚                     â”‚                       â”‚
     â”‚         2. Validate JWT Token               â”‚
     â”‚            â”œâ”€ Check signature                â”‚
     â”‚            â”œâ”€ Verify issuer                 â”‚
     â”‚            â”œâ”€ Verify audience                â”‚
     â”‚            â””â”€ Check expiration              â”‚
     â”‚                     â”‚                       â”‚
     â”‚         3. Extract Claims from JWT          â”‚
     â”‚            â”œâ”€ sub â†’ User ID                 â”‚
     â”‚            â”œâ”€ unique_name â†’ Username        â”‚
     â”‚            â””â”€ email â†’ Email                 â”‚
     â”‚                     â”‚                       â”‚
     â”‚         4. Check Authorization Policy       â”‚
     â”‚            (Route requires "authenticated") â”‚
     â”‚                     â”‚                       â”‚
     â”‚         5. Add Headers to Request           â”‚
     â”‚            â”œâ”€ X-User-Id: {guid}             â”‚
     â”‚            â”œâ”€ X-User-Name: {username}       â”‚
     â”‚            â””â”€ X-User-Email: {email}         â”‚
     â”‚                     â”‚                       â”‚
     â”‚                     â”‚ 6. Forward request    â”‚
     â”‚                     â”‚   with user headers   â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚                       â”‚
     â”‚                     â”‚            7. Read X-User-Id header
     â”‚                     â”‚            8. Get user's bookings
     â”‚                     â”‚            9. Return bookings
     â”‚                     â”‚                       â”‚
     â”‚                     â”‚ 10. Response          â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 11. 200 OK          â”‚                       â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
     â”‚                     â”‚                       â”‚
```

## 3. Unauthorized Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                 â”‚ API Gateway â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚ 1. GET /api/bookings        â”‚
     â”‚ (No Authorization header)   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                             â”‚
     â”‚         2. No token found   â”‚
     â”‚            â†“                â”‚
     â”‚         3. Return 401       â”‚
     â”‚                             â”‚
     â”‚ 4. 401 Unauthorized         â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                             â”‚
```

## 4. Invalid/Expired Token Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                 â”‚ API Gateway â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚ 1. GET /api/bookings        â”‚
     â”‚ Authorization: Bearer <EXPIRED_TOKEN>
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                             â”‚
     â”‚         2. Validate token   â”‚
     â”‚            â”œâ”€ Signature OK  â”‚
     â”‚            â”œâ”€ Issuer OK     â”‚
     â”‚            â””â”€ EXPIRED âŒ    â”‚
     â”‚                             â”‚
     â”‚         3. Token invalid    â”‚
     â”‚            â†“                â”‚
     â”‚         4. Return 401       â”‚
     â”‚                             â”‚
     â”‚ 5. 401 Unauthorized         â”‚
     â”‚    "Token expired"          â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                             â”‚
     â”‚ 6. Client needs to re-login â”‚
     â”‚                             â”‚
```

## 5. Resource Ownership Check Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚    â”‚ API Gateway â”‚    â”‚BookingServiceâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚                   â”‚
     â”‚ 1. GET /api/bookings/{booking-id}  â”‚
     â”‚ Authorization: Bearer <TOKEN>      â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
     â”‚                â”‚                   â”‚
     â”‚    2. Validate token (User A)      â”‚
     â”‚                â”‚                   â”‚
     â”‚    3. Forward with X-User-Id=A     â”‚
     â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                â”‚                   â”‚
     â”‚                â”‚        4. Get booking from DB
     â”‚                â”‚           â”œâ”€ booking.userId = B
     â”‚                â”‚           â”œâ”€ X-User-Id = A
     â”‚                â”‚           â””â”€ A â‰  B âŒ
     â”‚                â”‚                   â”‚
     â”‚                â”‚        5. Not owned by user
     â”‚                â”‚           â†“
     â”‚                â”‚        6. Return 403 Forbidden
     â”‚                â”‚                   â”‚
     â”‚                â”‚ 7. 403 Response   â”‚
     â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 8. 403 Forbiddenâ”‚                  â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
     â”‚                â”‚                   â”‚
```

## 6. Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT LAYER                        â”‚
â”‚  - Web Browser                                          â”‚
â”‚  - Mobile App                                           â”‚
â”‚  - External API Consumer                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTPS (Authorization: Bearer <token>)
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               API GATEWAY (Port 5000)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Middleware Pipeline:                              â”‚  â”‚
â”‚  â”‚ 1. Exception Handler                             â”‚  â”‚
â”‚  â”‚ 2. CORS                                          â”‚  â”‚
â”‚  â”‚ 3. âœ“ JWT Authentication â† Validates token        â”‚  â”‚
â”‚  â”‚ 4. âœ“ Authorization â† Checks policies             â”‚  â”‚
â”‚  â”‚ 5. âœ“ Claims Forwarding â† Adds user headers       â”‚  â”‚
â”‚  â”‚ 6. Request/Response Logging                      â”‚  â”‚
â”‚  â”‚ 7. YARP Reverse Proxy â† Routes to services      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  Route Configuration:                                   â”‚
â”‚  â€¢ /api/users/** â†’ Public (login/register)              â”‚
â”‚  â€¢ /api/bookings/** â†’ Requires authentication           â”‚
â”‚  â€¢ /api/payments/** â†’ Requires authentication           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚              â”‚              â”‚
            â”‚ Internal     â”‚ Internal     â”‚ Internal
            â”‚ Network      â”‚ Network      â”‚ Network
            â”‚              â”‚              â”‚
            â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UserService     â”‚ â”‚BookingServiceâ”‚ â”‚PaymentService  â”‚
â”‚   (Port 5001)     â”‚ â”‚ (Port 5002)  â”‚ â”‚  (Port 5003)   â”‚
â”‚                   â”‚ â”‚              â”‚ â”‚                â”‚
â”‚ Responsibilities: â”‚ â”‚Receives:     â”‚ â”‚Receives:       â”‚
â”‚ â€¢ Register        â”‚ â”‚ â€¢ Request    â”‚ â”‚ â€¢ Request      â”‚
â”‚ â€¢ Login           â”‚ â”‚ â€¢ X-User-Id  â”‚ â”‚ â€¢ X-User-Id    â”‚
â”‚ â€¢ Generate JWT    â”‚ â”‚ â€¢ X-User-Nameâ”‚ â”‚ â€¢ X-User-Name  â”‚
â”‚                   â”‚ â”‚ â€¢ X-User-Emailâ”‚ â”‚ â€¢ X-User-Emailâ”‚
â”‚ JWT Claims:       â”‚ â”‚              â”‚ â”‚                â”‚
â”‚ â€¢ sub (User ID)   â”‚ â”‚Actions:      â”‚ â”‚Actions:        â”‚
â”‚ â€¢ unique_name     â”‚ â”‚ â€¢ Create     â”‚ â”‚ â€¢ Process      â”‚
â”‚ â€¢ email           â”‚ â”‚   booking    â”‚ â”‚   payment      â”‚
â”‚ â€¢ exp             â”‚ â”‚ â€¢ Check      â”‚ â”‚ â€¢ Link to user â”‚
â”‚                   â”‚ â”‚   ownership  â”‚ â”‚                â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚                   â”‚
      â–¼                      â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚      â”‚ PostgreSQL   â”‚    â”‚   MongoDB    â”‚
â”‚   UserDB     â”‚      â”‚  BookingDB   â”‚    â”‚  PaymentDB   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. JWT Token Structure

```
Header:
{
  "alg": "HS256",           â† Algorithm
  "typ": "JWT"              â† Type
}

Payload (Claims):
{
  "sub": "123e4567-...",    â† Subject (User ID)
  "unique_name": "john_doe", â† Username
  "email": "john@ex.com",   â† Email
  "jti": "token-uuid",      â† Token ID
  "iss": "UserService",     â† Issuer
  "aud": "BookingSystem",   â† Audience
  "exp": 1735567890,        â† Expiration (Unix timestamp)
  "iat": 1735564290         â† Issued At (Unix timestamp)
}

Signature:
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  JWT_SECRET_KEY
)

Final Token Format:
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

     â†‘ Header          â†‘ Payload              â†‘ Signature
```

## 8. Security Decision Tree

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Request arrives â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Has Authorization â”‚
                   â”‚     header?       â”‚
                   â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                     â”‚ YES         â”‚ NO
                     â”‚             â”‚
                â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                â”‚Extract â”‚    â”‚ Return  â”‚
                â”‚ Token  â”‚    â”‚ 401     â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                â”‚ Validate â”‚
                â”‚  Token   â”‚
                â””â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                  â”‚     â”‚
            Valid â”‚     â”‚ Invalid
                  â”‚     â”‚
             â”Œâ”€â”€â”€â”€â–¼â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚Extractâ”‚ â”‚ Return   â”‚
             â”‚Claims â”‚ â”‚ 401      â”‚
             â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
          â”‚ Check       â”‚
          â”‚ Authorizationâ”‚
          â”‚ Policy      â”‚
          â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
            â”‚         â”‚
      Allowedâ”‚       â”‚ Denied
            â”‚         â”‚
       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
       â”‚Forward â”‚  â”‚ Return  â”‚
       â”‚to      â”‚  â”‚ 403     â”‚
       â”‚Service â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
            â”‚
       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Service      â”‚
       â”‚ Processes    â”‚
       â”‚ Request      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Concepts

### ğŸ” Authentication
**"Who are you?"**
- Verifying the user's identity
- Handled by JWT token validation
- Results in knowing the user ID

### ğŸ›¡ï¸ Authorization
**"What are you allowed to do?"**
- Verifying permissions/access rights
- Handled by policies and ownership checks
- Results in allowing or denying the action

### ğŸ« JWT Token
- Self-contained authentication token
- Contains user claims (ID, name, email)
- Signed by UserService
- Validated by API Gateway
- Cannot be tampered with (signature verification)

### ğŸ“¨ Claims Forwarding
- Gateway extracts validated user info from JWT
- Forwards as HTTP headers to services
- Services don't need to validate JWT
- Trust model: services trust the gateway
